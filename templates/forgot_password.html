{% extends "base.html" %}

{% block title %}Forgot Password - Shalabiverse{% endblock %}

{% block header %}Reset Password{% endblock %}
{% block subtitle %}Enter your email to receive reset instructions{% endblock %}

{% block content %}
<form method="POST" novalidate>
    {{ form.hidden_tag() }}
    
    <div class="form-group">
        {{ form.email.label(class="form-label") }}
        <i class="input-icon fas fa-envelope"></i>
        {{ form.email(class="form-control" + (" error" if form.email.errors else ""), placeholder="Enter your email address") }}
        {% if form.email.errors %}
            {% for error in form.email.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="form-group">
        {{ form.submit(class="btn btn-primary") }}
    </div>
</form>

<div class="auth-links">
    <p>Remember your password? <a href="{{ url_for('login') }}">Sign in here</a></p>
    <span class="separator">|</span>
    <p>Need an account? <a href="{{ url_for('register') }}">Create one here</a></p>
</div>

<div class="help-section">
    <h4><i class="fas fa-question-circle"></i> How it works</h4>
    <ol>
        <li>Enter the email address associated with your account</li>
        <li>Check your inbox for a password reset link</li>
        <li>Click the link and create a new password</li>
        <li>Sign in with your new password</li>
    </ol>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .form-label {
        color: var(--neutral-charcoal);
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }

    .help-section {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(74, 144, 226, 0.05);
        border-radius: 12px;
        border: 1px solid rgba(74, 144, 226, 0.1);
    }

    .help-section h4 {
        color: var(--neutral-charcoal);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1rem;
    }

    .help-section ol {
        margin: 0;
        padding-left: 1.5rem;
        color: var(--deep-sapphire);
    }

    .help-section li {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .security-notice {
        margin-top: 1.5rem;
        padding: 1rem;
        background: rgba(80, 200, 120, 0.05);
        border-radius: 8px;
        border-left: 4px solid var(--cta-emerald);
        font-size: 0.85rem;
        color: var(--deep-sapphire);
    }

    .security-notice i {
        color: var(--cta-emerald);
        margin-right: 0.5rem;
    }

    @media (max-width: 480px) {
        .help-section {
            padding: 1rem;
        }
        
        .help-section ol {
            padding-left: 1rem;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const emailInput = document.getElementById('email');
    const form = document.querySelector('form');
    
    // Auto-focus email input
    if (emailInput) {
        emailInput.focus();
    }
    
    // Email validation
    if (emailInput) {
        emailInput.addEventListener('input', function() {
            const email = this.value;
            const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            
            if (email && !isValid) {
                this.classList.add('error');
                showEmailError('Please enter a valid email address');
            } else {
                this.classList.remove('error');
                hideEmailError();
            }
        });
    }
    
    // Form submission handling
    form.addEventListener('submit', function(e) {
        const email = emailInput.value.trim();
        
        if (!email) {
            e.preventDefault();
            emailInput.classList.add('error');
            showEmailError('Email address is required');
            emailInput.focus();
            return;
        }
        
        const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        if (!isValid) {
            e.preventDefault();
            emailInput.classList.add('error');
            showEmailError('Please enter a valid email address');
            emailInput.focus();
            return;
        }
        
        // Show loading state
        const submitBtn = form.querySelector('button[type="submit"], input[type="submit"]');
        if (submitBtn) {
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';
        }
    });
    
    function showEmailError(message) {
        hideEmailError(); // Remove existing error first
        
        const errorSpan = document.createElement('span');
        errorSpan.className = 'error-message email-error';
        errorSpan.textContent = message;
        emailInput.parentElement.appendChild(errorSpan);
    }
    
    function hideEmailError() {
        const existingError = emailInput.parentElement.querySelector('.email-error');
        if (existingError) {
            existingError.remove();
        }
    }
    
    // Add security notice
    const authLinks = document.querySelector('.auth-links');
    const securityNotice = document.createElement('div');
    securityNotice.className = 'security-notice';
    securityNotice.innerHTML = `
        <i class="fas fa-shield-alt"></i>
        <strong>Security Notice:</strong> Password reset links expire after 1 hour for your security. 
        If you don't receive an email within a few minutes, please check your spam folder.
    `;
    authLinks.parentNode.insertBefore(securityNotice, authLinks.nextSibling);
});
</script>
{% endblock %}