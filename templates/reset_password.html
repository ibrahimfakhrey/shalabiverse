{% extends "base.html" %}

{% block title %}Reset Password - Shalabiverse{% endblock %}

{% block header %}Create New Password{% endblock %}
{% block subtitle %}Enter your new password below{% endblock %}

{% block content %}
<form method="POST" novalidate>
    {{ form.hidden_tag() }}
    
    <div class="form-group">
        {{ form.password.label(class="form-label") }}
        <i class="input-icon fas fa-lock"></i>
        {{ form.password(class="form-input" + (" error" if form.password.errors else ""), placeholder="Enter your new password") }}
        {% if form.password.errors %}
            {% for error in form.password.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="form-group">
        {{ form.password2.label(class="form-label") }}
        <i class="input-icon fas fa-lock"></i>
        {{ form.password2(class="form-input" + (" error" if form.password2.errors else ""), placeholder="Confirm your new password") }}
        {% if form.password2.errors %}
            {% for error in form.password2.errors %}
                <span class="error-message">{{ error }}</span>
            {% endfor %}
        {% endif %}
    </div>

    <div class="form-group">
        {{ form.submit(class="submit-btn") }}
    </div>
</form>

<div class="auth-links">
    <p>Remember your password? <a href="{{ url_for('login') }}">Sign in here</a></p>
</div>

<div class="security-tips">
    <h4><i class="fas fa-shield-alt"></i> Password Security Tips</h4>
    <ul>
        <li>Use at least 8 characters with a mix of letters, numbers, and symbols</li>
        <li>Avoid using personal information like names or birthdays</li>
        <li>Don't reuse passwords from other accounts</li>
        <li>Consider using a password manager for better security</li>
    </ul>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .form-label {
        color: var(--neutral-charcoal);
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }

    .security-tips {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(80, 200, 120, 0.05);
        border-radius: 12px;
        border: 1px solid rgba(80, 200, 120, 0.1);
    }

    .security-tips h4 {
        color: var(--neutral-charcoal);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1rem;
    }

    .security-tips ul {
        margin: 0;
        padding-left: 1.5rem;
        color: var(--deep-sapphire);
    }

    .security-tips li {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .password-strength {
        margin-top: 0.5rem;
        font-size: 0.8rem;
    }

    .strength-weak { color: var(--error-red); }
    .strength-medium { color: var(--warning-yellow); }
    .strength-strong { color: var(--success-green); }

    .password-requirements {
        margin-top: 0.5rem;
        font-size: 0.75rem;
        color: var(--deep-sapphire);
        opacity: 0.7;
    }

    .password-requirements ul {
        margin: 0.25rem 0 0 1rem;
        padding: 0;
    }

    .password-requirements li {
        margin-bottom: 0.2rem;
    }

    .requirement-met {
        color: var(--success-green);
    }

    @media (max-width: 480px) {
        .security-tips {
            padding: 1rem;
        }
        
        .security-tips ul {
            padding-left: 1rem;
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('password2');
    
    if (passwordInput) {
        // Add password strength indicator
        const strengthDiv = document.createElement('div');
        strengthDiv.className = 'password-strength';
        passwordInput.parentElement.appendChild(strengthDiv);
        
        // Add password requirements
        const requirementsDiv = document.createElement('div');
        requirementsDiv.className = 'password-requirements';
        requirementsDiv.innerHTML = `
            <ul>
                <li id="req-length">At least 8 characters</li>
                <li id="req-uppercase">One uppercase letter</li>
                <li id="req-lowercase">One lowercase letter</li>
                <li id="req-number">One number</li>
            </ul>
        `;
        passwordInput.parentElement.appendChild(requirementsDiv);
        
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            const strength = checkPasswordStrength(password);
            
            // Update strength indicator
            strengthDiv.textContent = `Password strength: ${strength.text}`;
            strengthDiv.className = `password-strength strength-${strength.level}`;
            
            // Update requirements
            updateRequirements(password);
        });
        
        // Auto-focus password input
        passwordInput.focus();
    }
    
    if (confirmPasswordInput && passwordInput) {
        confirmPasswordInput.addEventListener('input', function() {
            if (this.value && this.value !== passwordInput.value) {
                this.classList.add('error');
                showPasswordMismatch();
            } else {
                this.classList.remove('error');
                hidePasswordMismatch();
            }
        });
    }
    
    function checkPasswordStrength(password) {
        let score = 0;
        
        if (password.length >= 8) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[a-z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;
        
        if (score < 2) return { level: 'weak', text: 'Weak' };
        if (score < 4) return { level: 'medium', text: 'Medium' };
        return { level: 'strong', text: 'Strong' };
    }
    
    function updateRequirements(password) {
        const requirements = [
            { id: 'req-length', test: password.length >= 8 },
            { id: 'req-uppercase', test: /[A-Z]/.test(password) },
            { id: 'req-lowercase', test: /[a-z]/.test(password) },
            { id: 'req-number', test: /[0-9]/.test(password) }
        ];
        
        requirements.forEach(req => {
            const element = document.getElementById(req.id);
            if (element) {
                element.className = req.test ? 'requirement-met' : '';
            }
        });
    }
    
    function showPasswordMismatch() {
        let errorSpan = confirmPasswordInput.parentElement.querySelector('.password-mismatch');
        if (!errorSpan) {
            errorSpan = document.createElement('span');
            errorSpan.className = 'error-message password-mismatch';
            errorSpan.textContent = 'Passwords do not match';
            confirmPasswordInput.parentElement.appendChild(errorSpan);
        }
    }
    
    function hidePasswordMismatch() {
        const errorSpan = confirmPasswordInput.parentElement.querySelector('.password-mismatch');
        if (errorSpan) {
            errorSpan.remove();
        }
    }
    
    // Show/hide password functionality
    function addPasswordToggle(input) {
        const toggleButton = document.createElement('button');
        toggleButton.type = 'button';
        toggleButton.className = 'password-toggle';
        toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
        toggleButton.style.cssText = `
            position: absolute;
            right: 1rem;
            top: 2.2rem;
            background: none;
            border: none;
            color: var(--deep-sapphire);
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        `;
        
        input.parentElement.style.position = 'relative';
        input.parentElement.appendChild(toggleButton);
        
        toggleButton.addEventListener('click', function() {
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            
            const icon = this.querySelector('i');
            icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
        });
        
        toggleButton.addEventListener('mouseenter', function() {
            this.style.opacity = '1';
        });
        
        toggleButton.addEventListener('mouseleave', function() {
            this.style.opacity = '0.6';
        });
    }
    
    // Add toggle to both password fields
    if (passwordInput) addPasswordToggle(passwordInput);
    if (confirmPasswordInput) addPasswordToggle(confirmPasswordInput);
});
</script>
{% endblock %}